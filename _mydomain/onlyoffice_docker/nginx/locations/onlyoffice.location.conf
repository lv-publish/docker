# OnlyOffice chạy trên subpath /onlyoffice
location /onlyoffice/ {
    
    proxy_pass http://127.0.0.1:80/;
    proxy_http_version 1.1;
    
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection $proxy_connection;
    proxy_set_header Host $http_host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Host $the_host/onlyoffice;
    proxy_set_header X-Forwarded-Proto $the_scheme;
    
    # WebSocket support
    proxy_read_timeout 3600s;
    proxy_send_timeout 3600s;
}

# Proxy cho static resources của OnlyOffice
location ~* ^/onlyoffice/(web-apps|sdkjs|sdkjs-plugins|fonts)/ {
    
    proxy_pass http://127.0.0.1:8880/;
    proxy_http_version 1.1;
    
    proxy_set_header Host $http_host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Host $the_host/onlyoffice;
    proxy_set_header X-Forwarded-Proto $the_scheme;
    
    # Cache static files
    proxy_cache_bypass $http_upgrade;
    expires 1y;
    add_header Cache-Control "public, immutable";
}